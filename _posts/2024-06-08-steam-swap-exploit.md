---
layout: post
title: How Was Steam Swap Exploited?
date: 2024-06-08 11:46:00
description: Learn how Steam Swap was exploited, resulting in a loss of assets worth approximately $105,000.
tags: price-manipulation steam-swap
categories: blockchain-hacks
thumbnail: assets/img/steam-swap-exploit.png
related_posts: true
toc:
  sidebar: left
---

## TL;DR

On June 6, 2024, Steam Swap was exploited across two different transactions on the BNB chain due to a smart contract vulnerability, which resulted in a loss of assets worth approximately $105,000.

## Introduction to Steam Swap

Steam Swap is a decentralized digital asset trading platform dedicated to bridging the global digital asset trading markets.

## Vulnerability Assessment

The root cause of the exploit is due to the price manipulation of the underlying assets.

### Steps

**Step 1:**

We attempt to analyze [one of the attack transactions](https://app.blocksec.com/explorer/tx/bsc/0x40f3bdd0a3a8d0476ae6aa2875dc2ec60b80812e2a394b67a88260df57c65522) executed by [the exploiter](https://bscscan.com/address/0xb5f1f0f3e9e72f94db32e8fcddde972ebfdc748e#tokentxns).

**Step 2:**

The [vulnerable MineSTM contract](https://bscscan.com/address/0xb7d0a1adafa3e9e8d8e244c20b6277bee17a09b6#code) has a [sell function](https://bscscan.com/address/0xb7d0a1adafa3e9e8d8e244c20b6277bee17a09b6#code#F1#L633) that uses a reserve pair for liquidity calculation. Notably, this exploited contract was deployed roughly 16 hours before the incident took place.

```solidity
function sell(uint256 amount) external {
  eve_token_erc20.transferFrom(msg.sender, address(this), amount);
  (, uint256 r1, ) = inner_pair.getReserves();
  uint256 lpAmount = (amount * inner_pair.totalSupply()) / (2 * r1);
  uniswapV2Router.removeLiquidity(address(usdt_token_erc20), address(eve_token_erc20), lpAmount, 0, 0, msg.sender, block.timestamp);
}
```

**Step 3:**

The exploiter initially took a flash loan of 500,000 BSC-USD and used it to purchase roughly 2,740,041 STM tokens. The exploiter was able to manipulate this reserve balance by swapping a large amount of these tokens, and then ultimately called the above sell function to complete their attack.

**Step 4:**

The excess of the STM tokens were sold for profits worth approximately $91,670 before repaying the borrowed flash loan.

**Step 5:**

[Another attacker](https://bscscan.com/address/0x40a82dfdbf01630ea87a0372cf95fa8636fcad89), likely a copycat of the original exploiter, executed [yet another attack transaction](https://bscscan.com/tx/0x849ed7f687cc2ebd1f7c4bed0849893e829a74f512b7f4a18aea39a3ef4d83b1) to profit by roughly $13,892.

## Solution

The recent exploit of Steam Swap underscores the vital need for comprehensive security measures in smart contracts, especially given the sophisticated nature of this particular attack. Addressing the vulnerability observed in the reserve liquidity pair requires implementing stricter validations when processing sell functions in contracts. This could involve more robust calculations of liquidity based on accurate, real-time reserve checks, potentially integrating mechanisms like time-weighted averages to mitigate the risk of price manipulation.

Preventing price manipulation is critical, and one effective strategy is employing ChainLink like Oracle services to provide reliable price feeds rather than solely depending on internal reserves, which can be easily distorted through market maneuvers such as flash loans.

The fact that the contract was exploited shortly after its deployment raises concerns about its initial security measures. It suggests the possibility of an inside job or a deliberate act to deceive, leading to a potential rug-pull. These suspicions are compounded by the absence of a prior security audit, a standard practice that was surprisingly overlooked. Given the associations with reputable names like Uniswap, Binance, Metamask, and Andreessen Horowitz, the lack of initial auditing raises questions about the legitimacy of the operation and whether these partnerships were superficially used to gain trust.

In [response to the attack](https://x.com/SteamSwap_/status/1798832744816054592), the team’s decision to conduct a post-incident audit, although a step in the right direction, comes too late for those affected by the exploit. The timeline for this audit, set at 7–10 business days, reflects urgency but also highlights the absence of proactive security measures. This incident serves as a stark reminder of the need for thorough vetting and continuous security assessments of smart contracts to avoid such vulnerabilities and maintain trust within the trading community. The ultimate determination of whether this was a high-level scam designed to lure traders and liquidity providers will depend on the outcomes of the ongoing investigations and audits.

_This article was [originally published](https://medium.com/p/adb10ffe55bc) by Pukar Acharya for Neptune Mutual._
