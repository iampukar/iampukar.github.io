<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Analysis of the Tsuru Exploit | Pukar Acharya </title> <meta name="author" content="Pukar Acharya"> <meta name="description" content="Learn how Tsuru was exploited, resulting in a loss of 137.78 ETH which is worth $410,000."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>" > <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://iampukar.github.io/blog/2024/tsuru-exploit/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Pukar</span> Acharya </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Analysis of the Tsuru Exploit</h1> <p class="post-meta"> Created in May 13, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a> &nbsp; &middot; &nbsp; <a href="/blog/tag/access-control"> <i class="fa-solid fa-hashtag fa-sm"></i> access-control</a> &nbsp; <a href="/blog/tag/tsuru"> <i class="fa-solid fa-hashtag fa-sm"></i> tsuru</a> &nbsp; &middot; &nbsp; <a href="/blog/category/blockchain-hacks"> <i class="fa-solid fa-tag fa-sm"></i> blockchain-hacks</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="tldr">TL;DR</h2> <p>On May 10, 2024, Tsuru was exploited on the Base chain due to a smart contract vulnerability, which resulted in a loss of 137.78 ETH, which was worth approximately $410,000.</p> <h2 id="introduction-to-tsuru">Introduction to Tsuru</h2> <p>Tsuru is the original character created by a supposed Japanese illustrator, Tsurushima Tatsumi.</p> <h2 id="vulnerability-assessment">Vulnerability Assessment</h2> <p>The root cause of the exploit is a lack of regulated access control.</p> <h3 id="steps">Steps</h3> <p><strong>Step 1:</strong></p> <p>We attempt to analyse <a href="https://app.blocksec.com/explorer/tx/base/0xe63a8df8759f41937432cd34c590d85af61b3343cf438796c6ed2c8f5b906f62">the attack transaction</a> executed by <a href="https://basescan.org/address/0x7a5eb99c993f4c075c222f9327abc7426cfae386">the exploiter</a>.</p> <p><strong>Step 2:</strong></p> <p>The exploited <a href="https://basescan.org/address/0x75ac62ea5d058a7f88f0c3a5f8f73195277c93da#code">TSURUWrapper contract</a> had a vulnerable <a href="https://basescan.org/address/0x75ac62ea5d058a7f88f0c3a5f8f73195277c93da#code#L1848">onERC1155Received function</a> that lacked proper authentication and enough access control.</p> <pre><code class="language-solidity">function onERC1155Received(address, address from, uint256 id, uint256 amount, bytes calldata) external override nonReentrant returns (bytes4) {
  require(id == tokenID, "Token ID does not match");

  if (msg.sender == address(erc1155Contract)) {
    return this.onERC1155Received.selector;
  }

  _safeMint(from, amount * ERC1155_RATIO); // Adjust minting based on the ERC1155_RATIO
  return this.onERC1155Received.selector;
}
</code></pre> <p><strong>Step 3:</strong></p> <p>As long as the id or tokenID parameter in this function corresponds to the ID of the project, it would allow anyone to mint the TSURU token and later swap it for ETH in the Uniswap Liquidity pool.</p> <p><strong>Step 4:</strong></p> <p>This exploiter on the Base chain <a href="https://basescan.org/tx/0xfe091a2d175f488bd366d3a84e9c37a622d789bf4539defacfc5f2a08169e2ca">swapped</a> the <a href="https://basescan.org/tx/0x1f51bdcc52a44e81360597aeb77050c5049df202692a7121e352fdf7bde6283d">stolen 167 million Tsuru</a> for 137.78 ETH, which were worth approximately $410,000, and <a href="https://www.basescan.org/tx/0x1f51bdcc52a44e81360597aeb77050c5049df202692a7121e352fdf7bde6283d">then bridged</a> it to <a href="https://etherscan.io/address/0x5E209c84E8632c011B7B5209dda3f7e50409C446">this address</a> on the Ethereum Mainnet. This address on the Ethereum Mainnet also <a href="https://etherscan.io/tx/0x1a02f2843c45bed3e3c126e0778346a4d30b4e958ebed31d2e463a9be6558e05">received 40.95 ETH</a> worth of assets from <a href="https://twitter.com/PerpyFinance/status/1787385427403395562">an old incident</a> that traces back to the incident involving <a href="https://twitter.com/MetaSleuth/status/1788966866511438268">Perpy Finance</a>.</p> <p><strong>Step 5:</strong></p> <p>The project was hacked <a href="https://basescan.org/tx/0x0812740dc17439c08876ab94926404f4b13d0457d4f17ef355ba8ad02c18f8c0">roughly two hours</a> after its deployment, and at the time of this writing, the <a href="https://debank.com/profile/0x5e209c84e8632c011b7b5209dda3f7e50409c446">address of the exploiter on the Ethereum Mainnet</a> has a hold of 179.68 ETH, which is worth approximately $516,129.</p> <h2 id="aftermath">Aftermath</h2> <p>The <a href="https://twitter.com/TsuruBase/status/1788941543514223046">team acknowledged</a> the occurrence of the exploit and has also shared a detailed post-mortem report regarding the incident.</p> <h2 id="solution">Solution</h2> <p>To address the vulnerabilities exploited in the Tsuru smart contract, a multi-faceted approach focused on strengthening security protocols, improving contract design, and enhancing monitoring systems is essential. Firstly, introducing rigorous access control measures in smart contracts is critical. For the Tsuru case, specifically ensuring that the <code class="language-plaintext highlighter-rouge">onERC1155Received</code> function includes authentication checks to verify not only the contract addresses interacting but also the roles of the interacting accounts would prevent unauthorized access. This could be implemented by incorporating a modifier that checks if the caller is from a list of addresses pre-approved by the contract owner or holds a specific role defined within the contract’s governance framework.</p> <p>Additionally, enhancing the contract’s logic to handle unexpected inputs more safely is necessary. For instance, implementing checks that validate the state changes within the contract before and after executing critical functions could help. This ensures that even if an unauthorized party were to call a function, they would not be able to cause state changes that could lead to asset theft or other undesired outcomes.</p> <p>Improving the testing and deployment procedures is another crucial step. Before deployment, the contract should undergo thorough testing, including both automated tests and manual peer reviews. Utilizing testnets to simulate real-world usage and attacks can help uncover vulnerabilities that might not be evident in isolated tests. Furthermore, engaging external auditors to conduct security audits and offering bug bounty programs can incentivize the discovery and resolution of security flaws before they can be exploited maliciously.</p> <p><em>This article was <a href="https://medium.com/p/630816199ff4">originally published</a> by Pukar Acharya elsewhere.</em></p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/liquid-restaking-tokens/">The Rise of Liquid Restaking Tokens</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/uwu-lend-exploit/">Understanding the UwU Lend Exploit</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/steam-swap-exploit/">How Was Steam Swap Exploited?</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/gala-games-exploit/">Breaking down the 219M Gala Games Exploit</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/galaxy-fox-token-exploit/">How Was Galaxy Fox Token Exploited?</a> </li> </div> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> &copy; Copyright 2024 Pukar Acharya. All Rights Reserved. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hideBreadcrumbs noAutoLoadMdIcons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-publications",title:"publications",description:"publications by categories in reversed chronological order. generated by jekyll-scholar.",section:"Navigation",handler:()=>{window.location.href="/publications/"}},{id:"nav-repositories",title:"repositories",description:"These are details of some of the publicly available GitHub based repositories.",section:"Navigation",handler:()=>{window.location.href="/repositories/"}},{id:"post-the-rise-of-liquid-restaking-tokens",title:"The Rise of Liquid Restaking Tokens",description:"Learn how Liquid Restaking Tokens (LRTs) are revolutionizing blockchain security and efficiency by repurposing staked assets.",section:"Posts",handler:()=>{window.location.href="/blog/2024/liquid-restaking-tokens/"}},{id:"post-understanding-the-uwu-lend-exploit",title:"Understanding the UwU Lend Exploit",description:"Learn how UwU Lend was exploited, which resulted in a loss of assets worth $23 million.",section:"Posts",handler:()=>{window.location.href="/blog/2024/uwu-lend-exploit/"}},{id:"post-how-was-steam-swap-exploited",title:"How Was Steam Swap Exploited?",description:"Learn how Steam Swap was exploited, resulting in a loss of assets worth approximately $105,000.",section:"Posts",handler:()=>{window.location.href="/blog/2024/steam-swap-exploit/"}},{id:"post-breaking-down-the-219m-gala-games-exploit",title:"Breaking down the 219M Gala Games Exploit",description:"Learn how Gala Games was exploited, resulting in a loss of assets worth $219 million.",section:"Posts",handler:()=>{window.location.href="/blog/2024/gala-games-exploit/"}},{id:"post-analysis-of-the-tsuru-exploit",title:"Analysis of the Tsuru Exploit",description:"Learn how Tsuru was exploited, resulting in a loss of 137.78 ETH which is worth $410,000.",section:"Posts",handler:()=>{window.location.href="/blog/2024/tsuru-exploit/"}},{id:"post-how-was-galaxy-fox-token-exploited",title:"How Was Galaxy Fox Token Exploited?",description:"Learn how Galaxy Fox Token was exploited, resulting in a loss of assets worth $330,000.",section:"Posts",handler:()=>{window.location.href="/blog/2024/galaxy-fox-token-exploit/"}},{id:"post-how-was-ngfs-token-exploited",title:"How Was NGFS Token Exploited?",description:"Learn how NGFS Token was exploited, resulting in a loss of assets worth approximately $191,000.",section:"Posts",handler:()=>{window.location.href="/blog/2024/ngfs-token-exploit/"}},{id:"post-a-comprehensive-guide-to-supply-chain-attacks-in-the-web3-world",title:"A Comprehensive Guide To Supply Chain Attacks In The Web3 World",description:"A Comprehensive Guide To Supply Chain Attacks In The Web3 World",section:"Posts",handler:()=>{window.location.href="/blog/2023/supply-chain-attack/"}},{id:"socials-telegram",title:"Telegram",section:"Socials",handler:()=>{window.open("https://telegram.me/boredpukar","_blank")}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=MKlCVIIAAAAJ","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/iampukar","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/iampukar","_blank")}},{id:"socials-x",title:"X",description:"Twitter",section:"Socials",handler:()=>{window.open("https://twitter.com/boredpukar","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>